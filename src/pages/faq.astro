---
import Layout from '../layouts/Layout.astro';
import FAQ from '../components/FAQ.astro';
import { getFAQs } from '../lib/sanity';

const faqs = await getFAQs();

// Group FAQs by category
const faqsByCategory = faqs.reduce((acc: any, faq: any) => {
	if (!acc[faq.category]) {
		acc[faq.category] = [];
	}
	acc[faq.category].push(faq);
	return acc;
}, {});

const categoryLabels: Record<string, string> = {
	general: 'Questions générales',
	services: 'Nos services',
	booking: 'Réservations',
	pricing: 'Tarifs',
	contact: 'Contact',
};
---

<Layout
	title="FAQ - Questions fréquentes - Spirit Path Light"
	description="Trouvez les réponses à vos questions sur nos services spirituels, nos tarifs et nos modalités de réservation."
>
	<!-- Hero -->
	<section class="relative bg-gradient-to-br from-primary/10 via-secondary/10 to-accent/10 dark:from-primary/20 dark:via-secondary/20 dark:to-accent/20 py-20 transition-colors duration-300">
		<div class="container mx-auto px-4">
			<div class="max-w-4xl mx-auto text-center">
				<div class="w-20 h-20 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl">
					<svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
					</svg>
				</div>
				<h1 class="text-5xl md:text-6xl font-display font-bold text-gray-800 dark:text-gray-100 mb-6 transition-colors duration-300">
					Questions fréquentes
				</h1>
				<p class="text-xl text-gray-600 dark:text-gray-300 leading-relaxed transition-colors duration-300">
					Trouvez rapidement les réponses à vos questions sur nos services spirituels
				</p>
			</div>
		</div>
	</section>

	<!-- Search Bar (Future enhancement) -->
	<div class="container mx-auto px-4 -mt-8 relative z-10">
		<div class="max-w-2xl mx-auto">
			<div class="relative">
				<input
					type="text"
					placeholder="Rechercher une question..."
					id="faq-search"
					class="w-full px-6 py-4 pr-12 rounded-full border-2 border-gray-200 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all duration-300 shadow-lg"
				/>
				<button class="absolute right-2 top-1/2 -translate-y-1/2 w-10 h-10 bg-primary rounded-full flex items-center justify-center text-white hover:bg-primary/90 transition-colors duration-300">
					<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
					</svg>
				</button>
			</div>
		</div>
	</div>

	<!-- FAQ Sections by Category -->
	<div class="container mx-auto px-4 py-16">
		{Object.keys(faqsByCategory).length > 0 ? (
			Object.entries(faqsByCategory).map(([category, categoryFaqs]: [string, any]) => (
				<div class="mb-16">
					<FAQ
						faqs={categoryFaqs}
						title={categoryLabels[category] || category}
					/>
				</div>
			))
		) : (
			<div class="text-center py-20">
				<div class="w-24 h-24 bg-gradient-to-br from-primary/20 to-secondary/20 rounded-full flex items-center justify-center mx-auto mb-6">
					<svg class="w-12 h-12 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
					</svg>
				</div>
				<h2 class="text-3xl font-bold text-gray-800 dark:text-gray-100 mb-4">Aucune question pour le moment</h2>
				<p class="text-gray-600 dark:text-gray-400 mb-8">
					Les questions fréquentes seront ajoutées bientôt. En attendant, n'hésitez pas à nous contacter !
				</p>
				<a href="/contact" class="btn btn-primary px-8 py-3 rounded-full shadow-lg hover:shadow-xl transition-all duration-300">
					Nous contacter
				</a>
			</div>
		)}
	</div>

	<!-- Quick Links -->
	<div class="bg-gradient-to-br from-primary/5 to-secondary/5 dark:from-primary/10 dark:to-secondary/10 py-16 transition-colors duration-300">
		<div class="container mx-auto px-4">
			<div class="max-w-4xl mx-auto">
				<h3 class="text-2xl font-bold text-center text-gray-800 dark:text-gray-100 mb-8">Liens utiles</h3>
				<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
					<a
						href="/#services"
						class="group bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 text-center border border-gray-200 dark:border-gray-700"
					>
						<div class="w-12 h-12 bg-primary/20 dark:bg-primary/30 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300">
							<svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
							</svg>
						</div>
						<h4 class="font-semibold text-gray-800 dark:text-gray-100">Nos services</h4>
						<p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Découvrez nos accompagnements</p>
					</a>
					<a
						href="/contact"
						class="group bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 text-center border border-gray-200 dark:border-gray-700"
					>
						<div class="w-12 h-12 bg-secondary/20 dark:bg-secondary/30 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300">
							<svg class="w-6 h-6 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
							</svg>
						</div>
						<h4 class="font-semibold text-gray-800 dark:text-gray-100">Contact</h4>
						<p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Posez-nous vos questions</p>
					</a>
					<a
						href="/blog"
						class="group bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 text-center border border-gray-200 dark:border-gray-700"
					>
						<div class="w-12 h-12 bg-accent/20 dark:bg-accent/30 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300">
							<svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
							</svg>
						</div>
						<h4 class="font-semibold text-gray-800 dark:text-gray-100">Blog</h4>
						<p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Articles & conseils</p>
					</a>
				</div>
			</div>
		</div>
	</div>
</Layout>

<script>
	// Simple FAQ search functionality
	document.addEventListener('DOMContentLoaded', () => {
		const searchInput = document.getElementById('faq-search') as HTMLInputElement;
		if (!searchInput) return;

		searchInput.addEventListener('input', () => {
			const searchTerm = searchInput.value.toLowerCase();
			const faqDetails = document.querySelectorAll('details');

			faqDetails.forEach((detail) => {
				const question = detail.querySelector('summary')?.textContent?.toLowerCase() || '';
				const answer = detail.querySelector('.prose')?.textContent?.toLowerCase() || '';

				if (question.includes(searchTerm) || answer.includes(searchTerm)) {
					detail.style.display = 'block';
					if (searchTerm) {
						detail.setAttribute('open', '');
					}
				} else {
					detail.style.display = searchTerm ? 'none' : 'block';
				}
			});
		});
	});
</script>
