---
import { urlFor } from '../lib/sanity';

export interface Props {
	title: string;
	slug: string;
	excerpt?: string;
	mainImage: any;
	publishedAt: string;
	author?: any;
	categories?: any[];
	tags?: string[];
}

const { title, slug, excerpt, mainImage, publishedAt, author, categories, tags } = Astro.props;

// Format date
const formattedDate = new Date(publishedAt).toLocaleDateString('fr-FR', {
	day: 'numeric',
	month: 'long',
	year: 'numeric'
});

// Image URL
const imageUrl = mainImage ? urlFor(mainImage).width(800).height(500).url() : '/assets/images/Accueil.webp';
const imageAlt = mainImage?.alt || title;

// First category
const primaryCategory = categories && categories.length > 0 ? categories[0] : null;
---

<article class="group relative overflow-hidden rounded-2xl bg-base-100 shadow-lg hover:shadow-2xl transition-all duration-500">
	<a href={`/blog/${slug}`} class="block">
		<!-- Image -->
		<div class="relative h-64 overflow-hidden">
			<img
				src={imageUrl}
				alt={imageAlt}
				class="w-full h-full object-cover object-center group-hover:scale-110 transition-transform duration-700"
				loading="lazy"
			/>
			<div class="absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent"></div>

			<!-- Category badge -->
			{primaryCategory && (
				<div class="absolute top-4 left-4">
					<span class={`inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-${primaryCategory.color || 'primary'} text-white shadow-lg`}>
						{primaryCategory.title}
					</span>
				</div>
			)}

			<!-- Reading time estimate (based on 200 words/min) -->
			<div class="absolute bottom-4 right-4">
				<div class="bg-base-100/90 backdrop-blur-sm rounded-full px-3 py-1 flex items-center gap-1 shadow-lg">
					<svg class="w-4 h-4 text-base-content/70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
					</svg>
					<span class="text-sm text-base-content/70">5 min</span>
				</div>
			</div>
		</div>

		<!-- Content -->
		<div class="p-6">
			<!-- Title -->
			<h3 class="text-2xl font-bold text-base-content mb-3 group-hover:text-primary transition-colors duration-300 line-clamp-2">
				{title}
			</h3>

			<!-- Excerpt -->
			{excerpt && (
				<p class="text-base-content/70 leading-relaxed mb-4 line-clamp-3">
					{excerpt}
				</p>
			)}

			<!-- Tags -->
			{tags && tags.length > 0 && (
				<div class="flex flex-wrap gap-2 mb-4">
					{tags.slice(0, 3).map((tag: string) => (
						<span class="inline-flex items-center px-2 py-1 rounded-md bg-base-200 text-base-content/70 text-xs">
							#{tag}
						</span>
					))}
				</div>
			)}

			<!-- Footer with author and date -->
			<div class="flex items-center justify-between pt-4 border-t border-base-300">
				<div class="flex items-center gap-2">
					{author?.image && (
						<img
							src={urlFor(author.image).width(40).height(40).url()}
							alt={author.name}
							class="w-8 h-8 rounded-full object-cover"
						/>
					)}
					{!author?.image && (
						<div class="w-8 h-8 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-white font-semibold text-sm">
							{author?.name?.charAt(0) || 'C'}
						</div>
					)}
					<span class="text-sm text-base-content/70 font-medium">{author?.name || 'Camille Spirit'}</span>
				</div>
				<time datetime={publishedAt} class="text-sm text-base-content/60">
					{formattedDate}
				</time>
			</div>

			<!-- Read more link -->
			<div class="mt-4">
				<span class="inline-flex items-center gap-2 text-primary font-semibold group-hover:gap-3 transition-all duration-300">
					Lire la suite
					<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
					</svg>
				</span>
			</div>
		</div>
	</a>
</article>
