---
// Theme customizer component for dark mode colors
---

<button
	id="theme-customizer-btn"
	class="fixed bottom-20 right-4 sm:right-6 z-40 w-12 h-12 sm:w-14 sm:h-14 bg-gradient-to-br from-primary to-secondary rounded-full shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center group"
	aria-label="Personnaliser le thème"
	title="Personnaliser les couleurs"
>
	<svg class="w-6 h-6 sm:w-7 sm:h-7 text-white group-hover:rotate-90 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
		<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"></path>
	</svg>
</button>

<!-- Customizer Panel -->
<div
	id="theme-customizer-panel"
	class="fixed inset-y-0 right-0 z-50 w-full sm:w-96 bg-white dark:bg-gray-900 shadow-2xl transform translate-x-full transition-transform duration-300 overflow-y-auto"
>
	<div class="p-6">
		<!-- Header -->
		<div class="flex items-center justify-between mb-6">
			<h3 class="text-2xl font-bold text-gray-800 dark:text-gray-100">Personnaliser</h3>
			<button
				id="theme-customizer-close"
				class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
				aria-label="Fermer"
			>
				<svg class="w-6 h-6 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
				</svg>
			</button>
		</div>

		<!-- Theme Toggle -->
		<div class="mb-8 p-4 bg-gray-50 dark:bg-gray-800 rounded-xl">
			<label class="flex items-center justify-between cursor-pointer">
				<span class="text-sm font-semibold text-gray-700 dark:text-gray-300">Mode sombre</span>
				<div class="relative">
					<input type="checkbox" id="theme-toggle-customizer" class="sr-only peer" />
					<div class="w-14 h-7 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-primary"></div>
				</div>
			</label>
		</div>

		<!-- Color Presets -->
		<div class="mb-8">
			<h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Thèmes prédéfinis</h4>
			<div class="grid grid-cols-2 gap-3">
				<button
					class="theme-preset p-4 rounded-xl border-2 border-gray-200 dark:border-gray-700 hover:border-primary transition-colors text-left"
					data-preset="default"
				>
					<div class="flex gap-2 mb-2">
						<div class="w-6 h-6 rounded-full bg-[#4a6b4e]"></div>
						<div class="w-6 h-6 rounded-full bg-[#8a7f66]"></div>
						<div class="w-6 h-6 rounded-full bg-[#d4a59a]"></div>
					</div>
					<span class="text-sm font-medium text-gray-800 dark:text-gray-200">Nature</span>
				</button>
				<button
					class="theme-preset p-4 rounded-xl border-2 border-gray-200 dark:border-gray-700 hover:border-primary transition-colors text-left"
					data-preset="ocean"
				>
					<div class="flex gap-2 mb-2">
						<div class="w-6 h-6 rounded-full bg-[#2563eb]"></div>
						<div class="w-6 h-6 rounded-full bg-[#0891b2]"></div>
						<div class="w-6 h-6 rounded-full bg-[#7dd3fc]"></div>
					</div>
					<span class="text-sm font-medium text-gray-800 dark:text-gray-200">Océan</span>
				</button>
				<button
					class="theme-preset p-4 rounded-xl border-2 border-gray-200 dark:border-gray-700 hover:border-primary transition-colors text-left"
					data-preset="sunset"
				>
					<div class="flex gap-2 mb-2">
						<div class="w-6 h-6 rounded-full bg-[#dc2626]"></div>
						<div class="w-6 h-6 rounded-full bg-[#f59e0b]"></div>
						<div class="w-6 h-6 rounded-full bg-[#fbbf24]"></div>
					</div>
					<span class="text-sm font-medium text-gray-800 dark:text-gray-200">Coucher de soleil</span>
				</button>
				<button
					class="theme-preset p-4 rounded-xl border-2 border-gray-200 dark:border-gray-700 hover:border-primary transition-colors text-left"
					data-preset="lavender"
				>
					<div class="flex gap-2 mb-2">
						<div class="w-6 h-6 rounded-full bg-[#7c3aed]"></div>
						<div class="w-6 h-6 rounded-full bg-[#a78bfa]"></div>
						<div class="w-6 h-6 rounded-full bg-[#c4b5fd]"></div>
					</div>
					<span class="text-sm font-medium text-gray-800 dark:text-gray-200">Lavande</span>
				</button>
			</div>
		</div>

		<!-- Custom Colors -->
		<div class="mb-8">
			<h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Personnalisé</h4>
			<div class="space-y-4">
				<div>
					<label class="text-sm text-gray-600 dark:text-gray-400 mb-2 block">Couleur primaire</label>
					<div class="flex items-center gap-3">
						<input
							type="color"
							id="color-primary"
							value="#4a6b4e"
							class="w-12 h-12 rounded-lg cursor-pointer border-2 border-gray-200 dark:border-gray-700"
						/>
						<input
							type="text"
							id="color-primary-text"
							value="#4a6b4e"
							class="flex-1 px-3 py-2 rounded-lg border-2 border-gray-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100 text-sm"
						/>
					</div>
				</div>
				<div>
					<label class="text-sm text-gray-600 dark:text-gray-400 mb-2 block">Couleur secondaire</label>
					<div class="flex items-center gap-3">
						<input
							type="color"
							id="color-secondary"
							value="#8a7f66"
							class="w-12 h-12 rounded-lg cursor-pointer border-2 border-gray-200 dark:border-gray-700"
						/>
						<input
							type="text"
							id="color-secondary-text"
							value="#8a7f66"
							class="flex-1 px-3 py-2 rounded-lg border-2 border-gray-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100 text-sm"
						/>
					</div>
				</div>
				<div>
					<label class="text-sm text-gray-600 dark:text-gray-400 mb-2 block">Couleur accent</label>
					<div class="flex items-center gap-3">
						<input
							type="color"
							id="color-accent"
							value="#d4a59a"
							class="w-12 h-12 rounded-lg cursor-pointer border-2 border-gray-200 dark:border-gray-700"
						/>
						<input
							type="text"
							id="color-accent-text"
							value="#d4a59a"
							class="flex-1 px-3 py-2 rounded-lg border-2 border-gray-200 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100 text-sm"
						/>
					</div>
				</div>
			</div>
		</div>

		<!-- Reset Button -->
		<button
			id="theme-reset"
			class="w-full px-4 py-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-semibold hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
		>
			Réinitialiser par défaut
		</button>
	</div>
</div>

<!-- Backdrop -->
<div
	id="theme-customizer-backdrop"
	class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-40"
></div>

<script>
	const THEME_COLORS_KEY = 'spirit-path-theme-colors';

	interface ThemeColors {
		primary: string;
		secondary: string;
		accent: string;
	}

	const presets: Record<string, ThemeColors> = {
		default: { primary: '#4a6b4e', secondary: '#8a7f66', accent: '#d4a59a' },
		ocean: { primary: '#2563eb', secondary: '#0891b2', accent: '#7dd3fc' },
		sunset: { primary: '#dc2626', secondary: '#f59e0b', accent: '#fbbf24' },
		lavender: { primary: '#7c3aed', secondary: '#a78bfa', accent: '#c4b5fd' },
	};

	function getCustomColors(): ThemeColors {
		const stored = localStorage.getItem(THEME_COLORS_KEY);
		return stored ? JSON.parse(stored) : presets.default;
	}

	function setCustomColors(colors: ThemeColors) {
		localStorage.setItem(THEME_COLORS_KEY, JSON.stringify(colors));
		applyColors(colors);
	}

	function applyColors(colors: ThemeColors) {
		const root = document.documentElement;
		root.style.setProperty('--color-primary', colors.primary);
		root.style.setProperty('--color-secondary', colors.secondary);
		root.style.setProperty('--color-accent', colors.accent);
	}

	function updateColorInputs(colors: ThemeColors) {
		const primaryColor = document.getElementById('color-primary') as HTMLInputElement;
		const primaryText = document.getElementById('color-primary-text') as HTMLInputElement;
		const secondaryColor = document.getElementById('color-secondary') as HTMLInputElement;
		const secondaryText = document.getElementById('color-secondary-text') as HTMLInputElement;
		const accentColor = document.getElementById('color-accent') as HTMLInputElement;
		const accentText = document.getElementById('color-accent-text') as HTMLInputElement;

		if (primaryColor && primaryText) {
			primaryColor.value = colors.primary;
			primaryText.value = colors.primary;
		}
		if (secondaryColor && secondaryText) {
			secondaryColor.value = colors.secondary;
			secondaryText.value = colors.secondary;
		}
		if (accentColor && accentText) {
			accentColor.value = colors.accent;
			accentText.value = colors.accent;
		}
	}

	document.addEventListener('DOMContentLoaded', () => {
		// Apply custom colors on load
		const colors = getCustomColors();
		applyColors(colors);
		updateColorInputs(colors);

		const customizerBtn = document.getElementById('theme-customizer-btn');
		const customizerPanel = document.getElementById('theme-customizer-panel');
		const customizerClose = document.getElementById('theme-customizer-close');
		const customizerBackdrop = document.getElementById('theme-customizer-backdrop');
		const themeToggle = document.getElementById('theme-toggle-customizer') as HTMLInputElement;
		const themeReset = document.getElementById('theme-reset');

		// Open/Close panel
		const openPanel = () => {
			customizerPanel?.classList.remove('translate-x-full');
			customizerBackdrop?.classList.remove('hidden');
		};

		const closePanel = () => {
			customizerPanel?.classList.add('translate-x-full');
			customizerBackdrop?.classList.add('hidden');
		};

		customizerBtn?.addEventListener('click', openPanel);
		customizerClose?.addEventListener('click', closePanel);
		customizerBackdrop?.addEventListener('click', closePanel);

		// Theme toggle in customizer
		if (themeToggle) {
			const isDark = document.documentElement.classList.contains('dark');
			themeToggle.checked = isDark;

			themeToggle.addEventListener('change', () => {
				const newTheme = themeToggle.checked ? 'dark' : 'light';
				if (newTheme === 'dark') {
					document.documentElement.classList.add('dark');
				} else {
					document.documentElement.classList.remove('dark');
				}
				localStorage.setItem('spirit-path-theme', newTheme);
			});
		}

		// Preset buttons
		document.querySelectorAll('.theme-preset').forEach((btn) => {
			btn.addEventListener('click', () => {
				const preset = btn.getAttribute('data-preset');
				if (preset && presets[preset]) {
					setCustomColors(presets[preset]);
					updateColorInputs(presets[preset]);
				}
			});
		});

		// Color pickers
		const setupColorPicker = (colorId: string, textId: string, colorKey: keyof ThemeColors) => {
			const colorInput = document.getElementById(colorId) as HTMLInputElement;
			const textInput = document.getElementById(textId) as HTMLInputElement;

			if (colorInput && textInput) {
				colorInput.addEventListener('input', () => {
					textInput.value = colorInput.value;
					const colors = getCustomColors();
					colors[colorKey] = colorInput.value;
					setCustomColors(colors);
				});

				textInput.addEventListener('input', () => {
					if (/^#[0-9A-F]{6}$/i.test(textInput.value)) {
						colorInput.value = textInput.value;
						const colors = getCustomColors();
						colors[colorKey] = textInput.value;
						setCustomColors(colors);
					}
				});
			}
		};

		setupColorPicker('color-primary', 'color-primary-text', 'primary');
		setupColorPicker('color-secondary', 'color-secondary-text', 'secondary');
		setupColorPicker('color-accent', 'color-accent-text', 'accent');

		// Reset button
		themeReset?.addEventListener('click', () => {
			setCustomColors(presets.default);
			updateColorInputs(presets.default);
		});
	});
</script>
