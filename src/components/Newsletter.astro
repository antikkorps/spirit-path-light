---
export interface Props {
  variant?: "default" | "inline" | "centered"
  showNames?: boolean
}

const { variant = "default", showNames = false } = Astro.props
---

<div class={`newsletter-container ${variant}`}>
  {
    variant === "default" && (
      <div class="relative overflow-hidden rounded-3xl bg-gradient-to-br from-primary via-purple-600 to-secondary p-1 shadow-2xl hover:shadow-3xl transition-all duration-500 group">
        <!-- Animated background elements -->
        <div class="absolute inset-0 bg-gradient-to-br from-primary/20 via-transparent to-secondary/20 rounded-3xl"></div>
        <div class="absolute top-0 left-1/4 w-32 h-32 bg-base-100/10 rounded-full blur-2xl animate-pulse"></div>
        <div class="absolute bottom-0 right-1/4 w-24 h-24 bg-base-100/10 rounded-full blur-2xl animate-pulse delay-1000"></div>
        
        <!-- Main content -->
        <div class="relative bg-base-100 rounded-3xl p-8 md:p-12 text-center">
          <!-- Floating icon with animation -->
          <div class="relative mb-8">
            <div class="w-20 h-20 mx-auto relative">
              <!-- Outer ring animation -->
              <div class="absolute inset-0 bg-gradient-to-r from-primary to-secondary rounded-full animate-spin-slow opacity-20"></div>
              
              <!-- Main icon container -->
              <div class="absolute inset-2 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300">
                <svg
                  class="w-10 h-10 text-white relative z-10"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                  />
                </svg>
              </div>
              
              <!-- Sparkle effects -->
              <div class="absolute -top-2 -right-2 w-6 h-6 bg-yellow-400 rounded-full animate-pulse shadow-lg">
                <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                </svg>
              </div>
            </div>
          </div>

          <!-- Enhanced title with gradient -->
          <div class="mb-6">
            <h3 class="text-4xl md:text-5xl font-display font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent mb-3">
              Restez inspirÃ©Â·e
            </h3>
            <div class="flex items-center justify-center gap-2 text-sm text-base-content/60">
              <span class="inline-flex items-center gap-1">
                <svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                Gratuit et sans spam
              </span>
              <span class="text-gray-300">â€¢</span>
              <span class="inline-flex items-center gap-1">
                <svg class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
                  <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
                </svg>
                1 fois par semaine
              </span>
            </div>
          </div>

          <!-- Enhanced description -->
          <p class="text-base-content/70 text-lg leading-relaxed mb-8 max-w-lg mx-auto">
            Recevez des <span class="font-semibold text-primary">conseils spirituels exclusifs</span>, 
            des <span class="font-semibold text-secondary">mÃ©ditations guidÃ©es</span> et 
            des <span class="font-semibold text-purple-600">histoires inspirantes</span> 
            directement dans votre boÃ®te mail
          </p>

          <!-- Enhanced form with better UX -->
          <form class="newsletter-form max-w-md mx-auto" data-newsletter-form>
            <div class="relative">
              <div class="flex flex-col sm:flex-row gap-3">
                <div class="relative flex-1">
                  <input
                    type="email"
                    name="email"
                    placeholder="âœ¨ Votre adresse email"
                    class="w-full px-6 py-4 pr-12 rounded-2xl border-2 border-gray-200 bg-base-200 focus:border-primary focus:bg-base-100 focus:outline-none focus:ring-4 focus:ring-primary/10 transition-all duration-300 text-base-content placeholder-gray-400"
                    required
                  />
                  <!-- Email icon -->
                  <div class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                    </svg>
                  </div>
                </div>
                <button
                  type="submit"
                  class="relative px-8 py-4 bg-gradient-to-r from-primary to-secondary text-white font-semibold rounded-2xl shadow-lg hover:shadow-xl hover:scale-105 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none overflow-hidden group"
                >
                  <span class="relative z-10 flex items-center gap-2">
                    S'abonner
                    <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                    </svg>
                  </span>
                  <!-- Button shine effect -->
                  <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-700"></div>
                </button>
              </div>
              
              <!-- Privacy note -->
              <p class="text-xs text-base-content/60 mt-3 text-center">
                <svg class="w-3 h-3 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
                </svg>
                Vos donnÃ©es sont protÃ©gÃ©es. DÃ©sabonnement en 1 clic.
              </p>
            </div>
            
            <div class="newsletter-message mt-4 text-sm" />
          </form>

          <!-- Social proof / trust indicators -->
          <div class="mt-8 pt-6 border-t border-gray-100">
            <div class="flex items-center justify-center gap-6 text-sm text-base-content/60">
              <div class="flex items-center gap-1">
                <div class="flex -space-x-2">
                  <div class="w-6 h-6 bg-primary/20 rounded-full border-2 border-white flex items-center justify-center">
                    <span class="text-xs font-bold text-primary">âœ¨</span>
                  </div>
                  <div class="w-6 h-6 bg-secondary/20 rounded-full border-2 border-white flex items-center justify-center">
                    <span class="text-xs font-bold text-secondary">ðŸŒŸ</span>
                  </div>
                  <div class="w-6 h-6 bg-purple-100 rounded-full border-2 border-white flex items-center justify-center">
                    <span class="text-xs font-bold text-purple-600">ðŸ’«</span>
                  </div>
                </div>
                <span>Rejoignez <strong>500+</strong> abonnÃ©Â·eÂ·s</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    )
  }

  {
    variant === "inline" && (
      <div class="bg-base-100 dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700 transition-colors duration-300">
        <div class="flex items-center gap-4 mb-4">
          <div class="w-12 h-12 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center flex-shrink-0">
            <svg
              class="w-6 h-6 text-white"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
              />
            </svg>
          </div>
          <div>
            <h4 class="font-bold text-base-content dark:text-gray-100 text-lg">Newsletter</h4>
            <p class="text-sm text-base-content/70 dark:text-gray-400">Restez connectÃ©Â·e</p>
          </div>
        </div>
        <form class="newsletter-form" data-newsletter-form>
          {showNames && (
            <div class="grid grid-cols-2 gap-3 mb-3">
              <input
                type="text"
                name="firstName"
                placeholder="PrÃ©nom"
                class="px-4 py-2 rounded-lg border-2 border-gray-200 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-colors duration-300"
              />
              <input
                type="text"
                name="lastName"
                placeholder="Nom"
                class="px-4 py-2 rounded-lg border-2 border-gray-200 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-colors duration-300"
              />
            </div>
          )}
          <div class="flex gap-2">
            <input
              type="email"
              name="email"
              placeholder="Email"
              class="flex-1 px-4 py-2 rounded-lg border-2 border-gray-200 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-colors duration-300"
              required
            />
            <button
              type="submit"
              class="btn btn-primary px-6 py-2 rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              OK
            </button>
          </div>
          <div class="newsletter-message mt-3 text-sm" />
        </form>
      </div>
    )
  }

  {
    variant === "centered" && (
      <div class="max-w-md mx-auto text-center">
        <h3 class="text-2xl font-display font-bold text-base-content dark:text-gray-100 mb-3">
          Newsletter
        </h3>
        <p class="text-base-content/70 dark:text-gray-300 mb-6">Ne manquez aucune inspiration</p>
        <form class="newsletter-form" data-newsletter-form>
          <input
            type="email"
            name="email"
            placeholder="Votre email"
            class="w-full px-6 py-3 rounded-full border-2 border-gray-200 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-100 focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 mb-3 transition-colors duration-300"
            required
          />
          <button
            type="submit"
            class="w-full btn btn-primary rounded-full px-8 py-3 shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            S'inscrire
          </button>
          <div class="newsletter-message mt-3 text-sm" />
        </form>
      </div>
    )
  }
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const forms = document.querySelectorAll("[data-newsletter-form]")

    forms.forEach((form) => {
      form.addEventListener("submit", async (e) => {
        e.preventDefault()

        const formElement = e.target as HTMLFormElement
        const messageContainer = formElement.querySelector(
          ".newsletter-message"
        ) as HTMLElement
        const submitButton = formElement.querySelector(
          'button[type="submit"]'
        ) as HTMLButtonElement
        const emailInput = formElement.querySelector(
          'input[name="email"]'
        ) as HTMLInputElement
        const firstNameInput = formElement.querySelector(
          'input[name="firstName"]'
        ) as HTMLInputElement
        const lastNameInput = formElement.querySelector(
          'input[name="lastName"]'
        ) as HTMLInputElement

        // Disable submit button
        submitButton.disabled = true
        submitButton.textContent = "Inscription..."

        try {
          const response = await fetch("/api/newsletter", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              email: emailInput.value,
              firstName: firstNameInput?.value || "",
              lastName: lastNameInput?.value || "",
            }),
          })

          const data = await response.json()

          if (data.success) {
            messageContainer.className =
              "newsletter-message mt-4 text-sm text-green-600 dark:text-green-400 font-medium"
            messageContainer.textContent = data.message
            formElement.reset()
          } else {
            messageContainer.className =
              "newsletter-message mt-4 text-sm text-red-600 dark:text-red-400 font-medium"
            messageContainer.textContent = data.error || "Une erreur est survenue"
          }
        } catch (error) {
          messageContainer.className =
            "newsletter-message mt-4 text-sm text-red-600 dark:text-red-400 font-medium"
          messageContainer.textContent = "Erreur de connexion. Veuillez rÃ©essayer."
        } finally {
          // Re-enable submit button
          submitButton.disabled = false
          submitButton.textContent = formElement.classList.contains("inline")
            ? "OK"
            : "S'abonner"
        }
      })
    })
  })
</script>
