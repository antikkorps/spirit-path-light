---
import "../styles/global.css"
import CookieBanner from "../components/CookieBanner.astro"
import ThemeSwitch from "../components/ThemeSwitch.astro"

interface Props {
  title?: string
  description?: string
  ogImage?: string
  ogType?: string
  noindex?: boolean
}

const {
  title = "Spirit Path Light - Accompagnement spirituel et développement personnel",
  description = "Guidances spirituelles, communication animale et contact avec les défunts. Accompagnement bienveillant pour votre cheminement intérieur avec Camille Spirit.",
  ogImage = "/assets/images/Accueil.webp",
  ogType = "website",
  noindex = false,
} = Astro.props

const canonicalURL = new URL(Astro.url.pathname, Astro.site)
const ogImageURL = new URL(ogImage, Astro.site)
---

<!doctype html>
<html lang="fr" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- SEO Meta Tags -->
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL} />
    {noindex && <meta name="robots" content="noindex, nofollow" />}

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={ogType} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImageURL} />
    <meta property="og:site_name" content="Spirit Path Light" />
    <meta property="og:locale" content="fr_FR" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={canonicalURL} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImageURL} />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="apple-touch-icon" href="/assets/logo.webp" />

    <!-- Manifest -->
    <link rel="manifest" href="/manifest.json" />

    <!-- Theme Color -->
    <meta name="theme-color" content="#4A6B4E" />

    <!-- Generator -->
    <meta name="generator" content={Astro.generator} />

    <!-- Keywords -->
    <meta
      name="keywords"
      content="spiritualité, développement personnel, guidance spirituelle, communication animale, médium, contact défunt, bien-être, méditation, éveil spirituel"
    />

    <!-- Author -->
    <meta name="author" content="Camille Spirit" />

    <!-- Script d'initialisation immédiate du thème pour éviter le flash -->
    <script is:inline src="/scripts/theme-init.js"></script>
  </head>
  <body class="min-h-screen bg-base-200">
    <header class="sticky top-0 z-50 bg-base-100 shadow-md border-b border-base-300">
      <nav class="container mx-auto px-4 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-2">
            <div class="w-8 h-8 rounded-full bg-gradient-to-r from-primary to-secondary">
            </div>
            <span class="text-xl font-bold text-base-content">Spirit Path Light</span>
          </div>
          <div class="flex items-center gap-3">
            <div class="md:hidden">
              <ThemeSwitch />
            </div>
            <button
              id="mobile-menu-button"
              class="md:hidden p-2 rounded-full hover:bg-base-200"
              aria-label="Ouvrir le menu mobile"
              aria-expanded="false"
              aria-controls="mobile-menu"
            >
              <svg
                id="menu-icon"
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"></path>
              </svg>
              <svg
                id="close-icon"
                class="hidden w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
          <nav
            class="hidden md:flex items-center space-x-6"
            aria-label="Navigation principale"
          >
            <a
              href="/"
              class="text-base-content hover:text-primary transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded px-2 py-1"
              >Accueil</a
            >
            <a
              href="/blog"
              class="text-base-content hover:text-primary transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded px-2 py-1"
              >Blog</a
            >
            <a
              href="/#services"
              class="text-base-content hover:text-primary transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded px-2 py-1"
              >Services</a
            >
            <a
              href="/faq"
              class="text-base-content hover:text-primary transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded px-2 py-1"
              >FAQ</a
            >
            <a
              href="/contact"
              class="text-base-content hover:text-primary transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded px-2 py-1"
              >Contact</a
            >
            <ThemeSwitch />
          </nav>
        </div>
        <!-- Mobile Menu -->
        <div
          id="mobile-menu"
          class="hidden md:hidden absolute top-full left-0 right-0 bg-base-100 shadow-lg border-b border-base-300"
          role="navigation"
          aria-label="Menu mobile"
        >
          <div class="flex flex-col py-4">
            <a
              href="/"
              class="px-4 py-3 text-base-content hover:bg-base-200 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2"
              role="menuitem">Accueil</a
            >
            <a
              href="/blog"
              class="px-4 py-3 text-base-content hover:bg-base-200 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2"
              role="menuitem">Blog</a
            >
            <a
              href="/#services"
              class="px-4 py-3 text-base-content hover:bg-base-200 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2"
              role="menuitem">Services</a
            >
            <a
              href="/faq"
              class="px-4 py-3 text-base-content hover:bg-base-200 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2"
              role="menuitem">FAQ</a
            >
            <a
              href="/contact"
              class="px-4 py-3 text-base-content hover:bg-base-200 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2"
              role="menuitem">Contact</a
            >
          </div>
        </div>
      </nav>
    </header>

    <main class="py-8">
      <slot />
    </main>

    <footer class="py-8 mt-16 bg-base-100 text-base-content/70 border-t border-base-300">
      <div class="container mx-auto px-4">
        <div class="text-center">
          <p>&copy; 2024 Spirit Path Light. Tous droits réservés.</p>
        </div>
      </div>
    </footer>

    <CookieBanner />

    <script is:inline>
      // Mobile menu toggle uniquement (thème géré par DaisyUI + localStorage)
      document.addEventListener("DOMContentLoaded", () => {
        const mobileMenuButton = document.getElementById("mobile-menu-button")
        const mobileMenu = document.getElementById("mobile-menu")
        const menuIcon = document.getElementById("menu-icon")
        const closeIcon = document.getElementById("close-icon")

        if (mobileMenuButton && mobileMenu && menuIcon && closeIcon) {
          mobileMenuButton.addEventListener("click", () => {
            const isHidden = mobileMenu.classList.contains("hidden")
            mobileMenu.classList.toggle("hidden")
            menuIcon.classList.toggle("hidden")
            closeIcon.classList.toggle("hidden")

            // Update ARIA attributes
            mobileMenuButton.setAttribute("aria-expanded", (!isHidden).toString())
          })

          // Close menu when clicking on a link
          const menuLinks = mobileMenu.querySelectorAll("a")
          menuLinks.forEach((link) => {
            link.addEventListener("click", () => {
              mobileMenu.classList.add("hidden")
              menuIcon.classList.remove("hidden")
              closeIcon.classList.add("hidden")
              mobileMenuButton.setAttribute("aria-expanded", "false")
            })
          })

          // Close menu when pressing Escape
          document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && !mobileMenu.classList.contains("hidden")) {
              mobileMenu.classList.add("hidden")
              menuIcon.classList.remove("hidden")
              closeIcon.classList.add("hidden")
              mobileMenuButton.setAttribute("aria-expanded", "false")
              mobileMenuButton.focus()
            }
          })
        }
      })
    </script>
  </body>
</html>
