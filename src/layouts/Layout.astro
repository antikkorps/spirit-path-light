---
import "../styles/global.css"
import CookieBanner from "../components/CookieBanner.astro"
import ThemeSwitch from "../components/ThemeSwitch.astro"

interface Props {
  title?: string
  description?: string
  ogImage?: string
  ogType?: string
  noindex?: boolean
}

const {
  title = "Spirit Path Light - Accompagnement spirituel et développement personnel",
  description = "Guidances spirituelles, communication animale et contact avec les défunts. Accompagnement bienveillant pour votre cheminement intérieur avec Camille Spirit.",
  ogImage = "/assets/images/Accueil.webp",
  ogType = "website",
  noindex = false,
} = Astro.props

const canonicalURL = new URL(Astro.url.pathname, Astro.site)
const ogImageURL = new URL(ogImage, Astro.site)
---

<!doctype html>
<html lang="fr" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- SEO Meta Tags -->
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL} />
    {noindex && <meta name="robots" content="noindex, nofollow" />}

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={ogType} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImageURL} />
    <meta property="og:site_name" content="Spirit Path Light" />
    <meta property="og:locale" content="fr_FR" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={canonicalURL} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImageURL} />
    <meta name="twitter:image:alt" content={title} />
    <meta name="twitter:site" content="@camille_spirit" />
    <meta name="twitter:creator" content="@camille_spirit" />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="apple-touch-icon" href="/assets/logo.webp" />

    <!-- Manifest -->
    <link rel="manifest" href="/manifest.json" />

    <!-- Theme Color -->
    <meta name="theme-color" content="#4A6B4E" />

    <!-- Generator -->
    <meta name="generator" content={Astro.generator} />

    <!-- Keywords -->
    <meta
      name="keywords"
      content="spiritualité, développement personnel, guidance spirituelle, communication animale, médium, contact défunt, bien-être, méditation, éveil spirituel"
    />

    <!-- Author -->
    <meta name="author" content="Camille Spirit" />

    <!-- Script d'initialisation immédiate du thème pour éviter le flash -->
    <script is:inline>
      // Script d'initialisation simple du thème
      ;(function () {
        // Charger le thème sauvegardé ou utiliser la préférence système
        const savedTheme = localStorage.getItem("theme")
        const systemPrefersDark = window.matchMedia(
          "(prefers-color-scheme: dark)"
        ).matches

        const currentTheme = savedTheme || (systemPrefersDark ? "dark" : "light")

        // Appliquer le thème immédiatement
        document.documentElement.setAttribute("data-theme", currentTheme)
      })()
    </script>
  </head>
  <body class="min-h-screen bg-base-200">
    <header class="sticky top-0 z-50 bg-base-100 shadow-md border-b border-base-300">
      <nav class="container mx-auto px-4 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-2">
            <div class="w-8 h-8 rounded-full bg-gradient-to-r from-primary to-secondary">
            </div>
            <span class="text-xl font-bold text-base-content">Spirit Path Light</span>
          </div>
          <div class="flex items-center gap-3">
            <div class="md:hidden">
              <ThemeSwitch />
            </div>
            <button
              id="mobile-menu-button"
              class="md:hidden p-2 rounded-full hover:bg-base-200"
              aria-label="Ouvrir le menu mobile"
              aria-expanded="false"
              aria-controls="mobile-menu"
            >
              <svg
                id="menu-icon"
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"></path>
              </svg>
              <svg
                id="close-icon"
                class="hidden w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
          <nav
            class="hidden md:flex items-center space-x-6"
            aria-label="Navigation principale"
          >
            <a
              href="/"
              class="text-base-content hover:text-primary transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded px-2 py-1"
              >Accueil</a
            >
            <a
              href="/blog"
              class="text-base-content hover:text-primary transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded px-2 py-1"
              >Blog</a
            >
            <a
              href="/#services"
              class="text-base-content hover:text-primary transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded px-2 py-1"
              >Services</a
            >
            <a
              href="/faq"
              class="text-base-content hover:text-primary transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded px-2 py-1"
              >FAQ</a
            >
            <a
              href="/contact"
              class="text-base-content hover:text-primary transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded px-2 py-1"
              >Contact</a
            >
            <ThemeSwitch />
          </nav>
        </div>
        <!-- Mobile Menu - Full Screen Overlay -->
        <div
          id="mobile-menu"
          class="fixed inset-0 z-50 transform opacity-0 pointer-events-none transition-all duration-300 ease-in-out md:hidden"
          role="navigation"
          aria-label="Menu mobile"
        >
          <!-- Backdrop with blur -->
          <div 
            id="mobile-menu-backdrop"
            class="absolute inset-0 bg-gradient-to-br from-primary/95 via-secondary/95 to-primary/95 backdrop-blur-md"
          ></div>
          
          <!-- Menu Content -->
          <div class="relative h-full flex flex-col justify-center items-center px-6">
            <!-- Animated background elements -->
            <div class="absolute inset-0 overflow-hidden pointer-events-none">
              <div class="absolute top-20 left-10 w-32 h-32 bg-white/10 rounded-full blur-3xl animate-pulse"></div>
              <div class="absolute bottom-20 right-10 w-40 h-40 bg-white/5 rounded-full blur-3xl animate-pulse delay-1000"></div>
              <div class="absolute top-1/2 left-1/4 w-24 h-24 bg-white/10 rounded-full blur-2xl animate-pulse delay-500"></div>
            </div>
            
            <!-- Close button -->
            <button
              id="mobile-menu-close"
              class="absolute top-6 right-6 w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm border border-white/30 flex items-center justify-center hover:bg-white/30 transition-all duration-300 group"
              aria-label="Fermer le menu"
            >
              <svg class="w-6 h-6 text-white group-hover:scale-110 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
            
            <!-- Menu Items with staggered animation -->
            <nav class="relative z-10 space-y-6 text-center">
              <a
                href="/"
                class="mobile-menu-item block text-4xl font-display font-bold text-white hover:text-secondary transition-all duration-300 transform hover:scale-110 opacity-0 translate-y-8"
                role="menuitem"
                data-menu-delay="0"
              >
                Accueil
              </a>
              <a
                href="/blog"
                class="mobile-menu-item block text-4xl font-display font-bold text-white hover:text-secondary transition-all duration-300 transform hover:scale-110 opacity-0 translate-y-8"
                role="menuitem"
                data-menu-delay="100"
              >
                Blog
              </a>
              <a
                href="/#services"
                class="mobile-menu-item block text-4xl font-display font-bold text-white hover:text-secondary transition-all duration-300 transform hover:scale-110 opacity-0 translate-y-8"
                role="menuitem"
                data-menu-delay="200"
              >
                Services
              </a>
              <a
                href="/faq"
                class="mobile-menu-item block text-4xl font-display font-bold text-white hover:text-secondary transition-all duration-300 transform hover:scale-110 opacity-0 translate-y-8"
                role="menuitem"
                data-menu-delay="300"
              >
                FAQ
              </a>
              <a
                href="/contact"
                class="mobile-menu-item block text-4xl font-display font-bold text-white hover:text-secondary transition-all duration-300 transform hover:scale-110 opacity-0 translate-y-8"
                role="menuitem"
                data-menu-delay="400"
              >
                Contact
              </a>
            </nav>
            
            <!-- Theme switcher at bottom -->
            <div class="absolute bottom-6 left-6 z-10">
              <ThemeSwitch />
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="py-8">
      <slot />
    </main>

    <footer class="py-8 mt-16 bg-base-100 text-base-content/70 border-t border-base-300">
      <div class="container mx-auto px-4">
        <div class="text-center">
          <p>&copy; 2025 Spirit Path Light. Tous droits réservés.</p>
        </div>
      </div>
    </footer>

    <CookieBanner />

    <script is:inline>
      // Mobile menu toggle avec animations avancées
      document.addEventListener("DOMContentLoaded", () => {
        const mobileMenuButton = document.getElementById("mobile-menu-button")
        const mobileMenu = document.getElementById("mobile-menu")
        const mobileMenuClose = document.getElementById("mobile-menu-close")
        const mobileMenuBackdrop = document.getElementById("mobile-menu-backdrop")
        const menuIcon = document.getElementById("menu-icon")
        const closeIcon = document.getElementById("close-icon")

        if (mobileMenuButton && mobileMenu && mobileMenuClose && menuIcon && closeIcon) {
          let isOpen = false

          function openMobileMenu() {
            isOpen = true
            mobileMenu.classList.remove("opacity-0", "pointer-events-none")
            mobileMenu.classList.add("opacity-100", "pointer-events-auto")
            document.body.style.overflow = 'hidden'
            
            // Animate menu items with stagger
            const menuItems = mobileMenu.querySelectorAll('.mobile-menu-item')
            menuItems.forEach((item) => {
              const delay = parseInt(item.getAttribute('data-menu-delay') || '0')
              setTimeout(() => {
                item.classList.remove('opacity-0', 'translate-y-8')
                item.classList.add('opacity-100', 'translate-y-0')
              }, delay)
            })

            // Update icons and ARIA
            menuIcon.classList.add("hidden")
            closeIcon.classList.remove("hidden")
            mobileMenuButton.setAttribute("aria-expanded", "true")
          }

          function closeMobileMenu() {
            if (!isOpen) return
            
            isOpen = false
            mobileMenu.classList.add("opacity-0", "pointer-events-none")
            mobileMenu.classList.remove("opacity-100", "pointer-events-auto")
            document.body.style.overflow = ''
            
            // Reset menu items animation
            const menuItems = mobileMenu.querySelectorAll('.mobile-menu-item')
            menuItems.forEach((item) => {
              item.classList.add('opacity-0', 'translate-y-8')
              item.classList.remove('opacity-100', 'translate-y-0')
            })

            // Update icons and ARIA
            menuIcon.classList.remove("hidden")
            closeIcon.classList.add("hidden")
            mobileMenuButton.setAttribute("aria-expanded", "false")
            mobileMenuButton.focus()
          }

          // Toggle menu
          mobileMenuButton.addEventListener("click", () => {
            if (isOpen) {
              closeMobileMenu()
            } else {
              openMobileMenu()
            }
          })

          // Close menu with close button
          mobileMenuClose.addEventListener("click", closeMobileMenu)
          
          // Close menu with backdrop
          mobileMenuBackdrop.addEventListener("click", closeMobileMenu)

          // Close menu when clicking on a link
          const menuLinks = mobileMenu.querySelectorAll("a")
          menuLinks.forEach((link) => {
            link.addEventListener("click", () => {
              setTimeout(closeMobileMenu, 200) // Allow navigation to start
            })
          })

          // Close menu when pressing Escape
          document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && isOpen) {
              closeMobileMenu()
            }
          })
        }
      })
    </script>
  </body>
</html>
